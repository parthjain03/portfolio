<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAD Mass Calculator</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .input-field, .select-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .input-field:focus, .select-field:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px #c7d2fe;
        }
        .result-box {
            background-color: #f3f4f6;
            border-left: 4px solid #4f46e5;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <main class="w-full max-w-2xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">CAD Mass Calculator</h1>
            <p class="text-gray-600 mt-2">Calculate mass from volume and material density.</p>
        </header>

        <!-- Material Management Card -->
        <div class="card">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">1. Add or Manage Materials</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="input-group">
                    <label for="materialName" class="font-medium text-gray-700">Material Name</label>
                    <input type="text" id="materialName" placeholder="e.g., Aluminum 6061" class="input-field">
                </div>
                <div class="input-group">
                    <label for="materialDensity" class="font-medium text-gray-700">Density</label>
                    <div class="flex gap-2">
                        <input type="number" id="materialDensity" placeholder="e.g., 2.7" class="input-field w-2/3">
                        <select id="densityUnit" class="select-field w-1/3">
                            <option value="g/cm^3" selected>g/cm³</option>
                            <option value="kg/m^3">kg/m³</option>
                            <option value="kg/L">kg/L</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="mt-4 text-right">
                <button id="addMaterialBtn" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                    Add to List
                </button>
            </div>
        </div>

        <!-- Mass Calculation Card -->
        <div class="card">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">2. Calculate and Save Item</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="input-group">
                    <label for="materialSelect" class="font-medium text-gray-700">Select Material</label>
                    <select id="materialSelect" class="select-field"></select>
                </div>
                 <div class="input-group">
                    <label for="volumeInput" class="font-medium text-gray-700">Volume</label>
                    <div class="flex gap-2">
                        <input type="number" id="volumeInput" placeholder="Enter volume" class="input-field w-2/3">
                        <select id="volumeUnit" class="select-field w-1/3">
                            <option value="mm^3">mm³</option>
                            <option value="cm^3" selected>cm³</option>
                            <option value="m^3">m³</option>
                        </select>
                    </div>
                </div>
            </div>
             <div class="input-group mt-4">
                <label for="iterationName" class="font-medium text-gray-700">Item/Iteration Name (Optional)</label>
                <input type="text" id="iterationName" placeholder="e.g., V1 - Lightweight Frame" class="input-field">
            </div>
            <div class="mt-6 text-center">
                 <button id="calculateBtn" class="btn btn-primary w-full md:w-auto">Calculate & Add to History</button>
            </div>
            
            <div id="resultContainer" class="result-box hidden">
                <p class="text-gray-600 font-medium">Last Calculated Mass:</p>
                <p id="resultText" class="text-3xl font-bold text-indigo-600"></p>
            </div>
        </div>

        <!-- Calculation History Card -->
        <div class="card" id="historyCard" style="display: none;">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-700">3. Calculation History</h2>
                <button id="clearHistoryBtn" class="btn bg-red-500 hover:bg-red-600 text-white text-sm py-2 px-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                    Clear History
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3">Name</th>
                            <th scope="col" class="px-6 py-3">Material</th>
                            <th scope="col" class="px-6 py-3">Volume</th>
                            <th scope="col" class="px-6 py-3">Mass</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <!-- Rows will be inserted here -->
                    </tbody>
                </table>
                <p id="noHistoryText" class="text-center text-gray-500 py-4">No calculations yet. Your saved items will appear here.</p>
            </div>
        </div>

    </main>
    
    <!-- Notification Toast -->
    <div id="notification" class="fixed bottom-5 right-5 bg-red-500 text-white py-3 px-5 rounded-lg shadow-lg hidden transform translate-y-20 transition-transform duration-300 ease-out">
        <p id="notificationText"></p>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const materialNameInput = document.getElementById('materialName');
            const materialDensityInput = document.getElementById('materialDensity');
            const densityUnitSelect = document.getElementById('densityUnit');
            const addMaterialBtn = document.getElementById('addMaterialBtn');
            
            const materialSelect = document.getElementById('materialSelect');
            const volumeInput = document.getElementById('volumeInput');
            const volumeUnitSelect = document.getElementById('volumeUnit');
            const iterationNameInput = document.getElementById('iterationName');
            const calculateBtn = document.getElementById('calculateBtn');

            const resultContainer = document.getElementById('resultContainer');
            const resultText = document.getElementById('resultText');

            const historyCard = document.getElementById('historyCard');
            const historyTableBody = document.getElementById('historyTableBody');
            const noHistoryText = document.getElementById('noHistoryText');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');

            // --- Data Store ---
            let materials = [
                { name: "Steel", density: 7.85, unit: "g/cm^3" },
                { name: "Invar 36", density: 8.055, unit: "g/cm^3" },
                { name: "Aluminum", density: 2.7, unit: "g/cm^3" },
                { name: "Titanium", density: 4.5, unit: "g/cm^3" },
                { name: "Copper", density: 8.96, unit: "g/cm^3" },
                { name: "PLA", density: 1.24, unit: "g/cm^3" },
                { name: "ABS", density: 1.04, unit: "g/cm^3" },
                { name: "Water", density: 1, unit: "g/cm^3" },
            ];
            let iterations = [];

            // --- Functions ---
            
            /**
             * Shows a notification message.
             * @param {string} message - The message to display.
             * @param {string} type - 'success' or 'error'.
             */
            function showNotification(message, type = 'error') {
                notificationText.textContent = message;
                notification.classList.remove('bg-red-500', 'bg-green-500', 'translate-y-20');
                notification.classList.add(type === 'error' ? 'bg-red-500' : 'bg-green-500');
                notification.classList.remove('hidden');
                // Animate in
                setTimeout(() => notification.classList.remove('translate-y-20'), 10);
                // Animate out and hide
                setTimeout(() => {
                    notification.classList.add('translate-y-20');
                    setTimeout(() => notification.classList.add('hidden'), 300);
                }, 3000);
            }

            /**
             * Renders the calculation history into the table.
             */
            function renderIterations() {
                historyTableBody.innerHTML = ''; // Clear existing rows

                if (iterations.length === 0) {
                    historyCard.style.display = 'none';
                    noHistoryText.style.display = 'block';
                } else {
                    historyCard.style.display = 'block';
                    noHistoryText.style.display = 'none';
                    iterations.forEach(item => {
                        const row = document.createElement('tr');
                        row.className = 'bg-white border-b hover:bg-gray-50';
                        row.innerHTML = `
                            <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${item.name}</td>
                            <td class="px-6 py-4">${item.materialName}</td>
                            <td class="px-6 py-4">${item.volume.toFixed(3)} ${item.volumeUnit}</td>
                            <td class="px-6 py-4 font-semibold text-indigo-600">${item.mass.toFixed(3)} ${item.massUnit}</td>
                        `;
                        historyTableBody.appendChild(row);
                    });
                }
            }

            /**
             * Updates the material selection dropdown with current materials.
             */
            function updateMaterialSelector() {
                materialSelect.innerHTML = ''; // Clear existing options
                materials.forEach((material, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${material.name} (${material.density} ${material.unit})`;
                    materialSelect.appendChild(option);
                });
            }

            /**
             * Converts any given density to the base unit (g/cm³).
             * @param {number} density - The density value.
             * @param {string} unit - The unit of the density ('g/cm^3', 'kg/m^3', 'kg/L').
             * @returns {number} The density in g/cm³.
             */
            function convertDensityToBase(density, unit) {
                if (unit === 'kg/m^3') { return density / 1000; }
                if (unit === 'kg/L') { return density; }
                return density;
            }
            
            /**
             * Converts any given volume to the base unit (cm³).
             * @param {number} volume - The volume value.
             * @param {string} unit - The unit of the volume ('cm^3', 'mm^3', 'm^3').
             * @returns {number} The volume in cm³.
             */
            function convertVolumeToBase(volume, unit) {
                if (unit === 'mm^3') { return volume / 1000; }
                if (unit === 'm^3') { return volume * 1000000; }
                return volume;
            }

            /**
             * Adds a new material to the list and updates the UI.
             */
            function addMaterial() {
                const name = materialNameInput.value.trim();
                const density = parseFloat(materialDensityInput.value);
                const unit = densityUnitSelect.value;

                if (name && !isNaN(density) && density > 0) {
                    materials.push({ name, density, unit });
                    updateMaterialSelector();
                    materialNameInput.value = '';
                    materialDensityInput.value = '';
                    showNotification('Material added successfully!', 'success');
                } else {
                    showNotification('Please enter a valid material name and a positive density.');
                }
            }
            
            /**
             * Calculates mass, displays it, and saves it to history.
             */
            function calculateMass() {
                const selectedIndex = materialSelect.value;
                const volume = parseFloat(volumeInput.value);
                const volumeUnit = volumeUnitSelect.value;
                let iterationName = iterationNameInput.value.trim();
                
                if (isNaN(volume) || volume < 0) {
                    showNotification('Please enter a valid, non-negative volume.');
                    return;
                }

                if (!materials[selectedIndex]) {
                    showNotification('Please select a valid material.');
                    return;
                }

                const material = materials[selectedIndex];
                const baseDensity = convertDensityToBase(material.density, material.unit);
                const baseVolume = convertVolumeToBase(volume, volumeUnit);
                let mass = baseDensity * baseVolume; // Mass in grams
                
                let displayMass = mass;
                let displayUnit = 'g';
                if (mass >= 1000) {
                    displayMass = mass / 1000;
                    displayUnit = 'kg';
                }
                if (displayMass >= 1000 && displayUnit === 'kg') {
                    displayMass = displayMass / 1000;
                    displayUnit = 'tonnes';
                }

                if (iterationName === '') {
                    iterationName = `Item #${iterations.length + 1}`;
                }
                iterations.push({
                    name: iterationName,
                    materialName: material.name,
                    volume: volume,
                    volumeUnit: volumeUnit,
                    mass: displayMass,
                    massUnit: displayUnit
                });
                renderIterations();
                iterationNameInput.value = ''; // Clear for next entry

                resultText.textContent = `${displayMass.toFixed(3)} ${displayUnit}`;
                resultContainer.classList.remove('hidden');
            }

            /**
             * Clears the calculation history.
             */
            function clearHistory() {
                iterations = [];
                renderIterations();
                showNotification('History has been cleared.', 'success');
            }

            // --- Event Listeners ---
            addMaterialBtn.addEventListener('click', addMaterial);
            calculateBtn.addEventListener('click', calculateMass);
            clearHistoryBtn.addEventListener('click', clearHistory);

            // --- Initial Setup ---
            updateMaterialSelector();
            renderIterations();
        });
    </script>

</body>
</html>
